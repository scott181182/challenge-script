{
    "$schema": "https://json-schema.org/draft/2020-12/output/schema",
    "$id": "https://raw.githubusercontent.com/scott181182/challenge-script/refs/heads/main/challenge.schema.json",
    "title": "Challenge",
    "description": "A challenge definition, used by the challenge script to execute coding challenges",
    "$defs": {
        "CommandConfig": {
            "type": "object",
            "properties": {
                "command": {
                    "description": "The command to run for this group of challenges",
                    "oneOf": [
                        {
                            "type": "string"
                        },
                        {
                            "type": "array",
                            "items": {
                                "type": "string"
                            }
                        }
                    ]
                }
            }
        },
        "CaseConfig": {
            "type": "object",
            "properties": {
                "environment": {
                    "description": "Environment variables to set when running a command. Conflicting variables override higher-level environment definitions.",
                    "type": "object",
                    "additionalProperties": {
                        "type": "string"
                    }
                },
                "arguments": {
                    "description": "Additional arguments to pass when running a command. Will be appended after any higher-level argument definitions.",
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                }
            }
        },
        "NestedChallengeGroup": {
            "type": "object",
            "allOf": [
                {
                    "$ref": "#/$defs/CaseConfig"
                },
                {
                    "$ref": "#/$defs/CommandConfig"
                }
            ],
            "properties": {
                "name": {
                    "type": "string",
                    "description": "Name of this challenge group"
                },
                "parts": {
                    "description": "Nested challenge groups",
                    "type": "array",
                    "items": {
                        "oneOf": [
                            {
                                "$ref": "#/$defs/NestedChallengeGroup"
                            },
                            {
                                "$ref": "#/$defs/ChallengeGroup"
                            }
                        ]
                    }
                }
            },
            "required": [
                "name",
                "parts"
            ]
        },
        "ChallengeGroup": {
            "type": "object",
            "allOf": [
                {
                    "$ref": "#/$defs/CaseConfig"
                },
                {
                    "$ref": "#/$defs/CommandConfig"
                }
            ],
            "properties": {
                "name": {
                    "type": "string",
                    "description": "Name of this challenge group"
                },
                "cases": {
                    "description": "The input/output cases for this challenge group",
                    "type": "array",
                    "items": {
                        "$ref": "#/$defs/ChallengeCase"
                    }
                }
            },
            "required": [
                "name",
                "cases"
            ]
        },
        "ChallengeCase": {
            "type": "object",
            "allOf": [
                {
                    "$ref": "#/$defs/CaseConfig"
                }
            ],
            "properties": {
                "name": {
                    "description": "Name of this challenge case, used to reference it in commands",
                    "type": "string"
                },
                "stdin": {
                    "description": "Data to pass to the stdin when running this case",
                    "$ref": "#/$defs/StringReference"
                },
                "expected": {
                    "description": "Expected output for this challenge case",
                    "type": "object",
                    "properties": {
                        "stdout": {
                            "description": "Data expected on stdout after running this case",
                            "$ref": "#/$defs/StringReference"
                        }
                    }
                }
            },
            "required": [
                "name"
            ]
        },
        "StringReference": {
            "oneOf": [
                {
                    "type": "string"
                },
                {
                    "type": "object",
                    "properties": {
                        "file": {
                            "description": "Path of the file to load data from (relative to this challenge file)",
                            "type": "string"
                        }
                    },
                    "required": [
                        "file"
                    ]
                }
            ]
        }
    },
    "oneOf": [
        {
            "$ref": "#/$defs/NestedChallengeGroup"
        },
        {
            "$ref": "#/$defs/ChallengeGroup"
        }
    ]
}